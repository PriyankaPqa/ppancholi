steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '16.x'
    displayName: 'Install Node.js'

  - task: Cache@2
    displayName: Cache yarn packages
    inputs:
      key: '"$(Agent.OS)" | **/yarn.lock, !**/node_modules/**/yarn.lock, !**/.*/**/yarn.lock'
      path: $(Build.SourcesDirectory)/node_modules
      cacheHitVar: CACHE_HIT

  - task: Yarn@3
    displayName: 'Install yarn packages'
    condition: ne(variables['CACHE_HIT'], 'true')
    inputs:
     customRegistry: 'useFeed'
     customFeed: ${{ parameters.packageFeed }}
     arguments: --frozen-lockfile

  - script: yarn ${{ parameters.lokaliseCommand }}
    displayName: 'Lokalise Sync'
    workingDirectory: ${{ parameters.workingDir }}
    condition: and(succeeded(), eq('${{ parameters.lokalise }}', true))

  - script: yarn ${{ parameters.buildCommand }}
    displayName: 'Build'
    workingDirectory: ${{ parameters.workingDir }}


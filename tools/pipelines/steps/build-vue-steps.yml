parameters:
  packageFeed: ''
  buildCommand: ''
  workingDir: ''
  lokaliseCommand: ''
  lokalise: ''
  nodeJsVersion: ''
  appVersion: ''
  disableCache: ''

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '${{ parameters.nodeJsVersion }}'
    displayName: 'Install Node.js'

  - template: '../steps/cache-install-npm.yml'
    parameters:
      packageFeed: ${{ parameters.packageFeed }}
      nodeJsVersion: ${{ parameters.nodeJsVersion }}
      disableCache: ${{ parameters.disableCache }}

  - script: node ./tools/scripts/replace.js emis-app/public/app-details.json "#{VUE_APP_VERSION}#" ${{ parameters.appVersion }}
    displayName: 'Inject app version'

  - script: yarn ${{ parameters.lokaliseCommand }}
    displayName: 'Lokalise Sync'
    workingDirectory: ${{ parameters.workingDir }}
    condition: and(succeeded(), eq('${{ parameters.lokalise }}', true))

  - script: yarn ${{ parameters.buildCommand }}
    displayName: 'Build'
    workingDirectory: ${{ parameters.workingDir }}

